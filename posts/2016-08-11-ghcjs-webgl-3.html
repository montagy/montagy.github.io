<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <title>montagy - ghcjs webgl 初探(三)</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <meta name="keywords" content="montagy blog home haskell programming" />
        <meta name="description" content="a haskell programmer's blog" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Montagy</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <div class="content">
            <h1>ghcjs webgl 初探(三)</h1>

            <div class="info">
    发表于: August 11, 2016
    
</div>
<div class="info">
    
      Tags: <a href="../tags/ghcjs.html">ghcjs</a>, <a href="../tags/webgl.html">webgl</a>
    
</div>

<p>着色器程序是在GPU中运行的,那CPU如何将数据发送给GPU来运行了?</p>
<h2 id="webgl">WebGL</h2>
<p>用着色器中的attribute 或 uniform变量.</p>
<p><em>graph.vert</em></p>
<div class="sourceCode"><pre class="sourceCode glsl"><code class="sourceCode glsl"><span class="dt">attribute</span> <span class="dt">vec4</span> a_Position;
<span class="dt">uniform</span> <span class="dt">float</span> u_PointSize;
<span class="dt">void</span> <span class="fu">main</span>() {
  <span class="fu">gl_Position</span> = a_Position;
  <span class="fu">gl_PointSize</span> = u_PointSize;
}</code></pre></div>
<p>attribute变量传输的是与顶点相关的数据.uniform变量传输的是与所有顶点都相同的数据.</p>
<h2 id="ghcjs">ghcjs</h2>
<p>在上文中我们创建了program(createProgram),并用它加载了着色器并使用,现在我们就向program 绑定的顶点着色器中的attribute变量a_Position,和uniform变量u_PointSize传输数据.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">aPosition <span class="ot">&lt;-</span> getAttribLocation gl prog <span class="st">&quot;a_Position&quot;</span>
vertexAttrib3f gl (fromIntegral aPosition) <span class="fl">0.5</span> <span class="fl">0.0</span> <span class="fl">0.0</span>

uPointSize <span class="ot">&lt;-</span> getUniformLocation gl prog <span class="st">&quot;u_PointSize&quot;</span>
uniform1f gl uPointSize <span class="fl">10.0</span></code></pre></div>
<p>首先我们用getAttribLocation来通过名字获得a_Position的地址,这个地址是GLint类型,也就是Int32(都是 通过文档查到的).我们通过vertexAttrib3f来给这个地址发送3个GLfloat值,GLfloat就是Double,所以用小数点 表示的数字就可以了.而vertexAttrib3f需要的地址值为GLuint,也就是Word32,而aPosition是Int32类型, 这在强类型的语言里是不能自动转换的,需要手动转换.因为Int32和Word32都是Integral和Num的实例,所以可以很方便的用 fromIntegral在他们之间转换.这样就给着色器中attribute变量a_Position传输了三个Double值0.5, 0.0, 0.0.</p>
<p>像GLint,GLuint这种GL开头的类型是opengl为了兼容性自己定义的基本数据类型,方便在不同的操作系统上移植. 他们会实际对应一个“本地”的类型.</p>
<p>同attribute类似,我们用getUniformLocation通过变量名来得到u_PointSize的地址,不同于attribute变量的地址 是个Int32数字,uniform变量的地址是个WebGLUniformLocation类型,而uniform1f需要的也是这个类型,免去了转换.</p>
<h2 id="后记">后记</h2>
<p>我们的程序非常简单,给a_Position就传输了一个顶点(0.5, 0.0, 0.0),给uniform1f传输了一个浮点数10.0.这在 webgl的世界里面就是print hello world级别.我想再写完一篇webgl的绘制原理之后再深入webgl.下篇我还是把重心放在 ghcjs上,演示下ghcjs-dom下如何绑定事件.</p>

<nav>
  <ul>
    
      <li class="left"><a href="../posts/2016-08-10-ghcjs-webgl-2.html">Previous</a></li>
    
    
      <li class="right"><a href="../posts/2016-08-12-ghcjs-webgl-4.html">Next</a></li>
    
  </ul>
</nav>

        </div>
        <!--<div id="disqus_thread"></div>-->
        <!--<script>-->
          <!--(function() { -->
              <!--var d = document, s = d.createElement('script');-->
              <!--s.src = '//montagy-github-io.disqus.com/embed.js';-->
              <!--s.setAttribute('data-timestamp', +new Date());-->
              <!--(d.head || d.body).appendChild(s);-->
          <!--})();-->
        <!--</script>-->
        <!--<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
